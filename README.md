# Darcy #
This repository contains:
* Darcy, a tool designed to automatically detect and repair architectural inconsistencies that may arise in developing Java applications using Java Platform Module System
* The input data needed for running this tool
* The materials used in evaluating it

In the following sections, we explain all the materials contained in this repository.

## 1. Darcy: Detection and Repair of Architectural Inconsistencies in Java ##
Darcy’s main goal is to detect and repair architectural inconsistencies that may arise within Java applications using Java Platform Module System (JPMS), introduced in the 9th version of Java. In the paper, we formally specify eight types of inconsistent dependencies that may arise when using JPMS. Darcy leverages these definitions and static analyses to automatically (1) detect the specified inconsistent dependencies within Java applications and (2) repair those identified inconsistencies.Darcy’s implementation contains several components:
* Class Dependency Analysis: To identify actual dependencies of an input Java application, Darcy relies on an static analysis tool, Classycle [1] , which provides a complete report of all dependencies in source code of a Java application at both the class and package levels. (`TraverseDir.py`)
* Parsing the XML files generated by Classycle, implemented in Python (`ParseXML.py`)
* Java Inconsistency Analysis: To identify all types of inconsistency scenarios, for each directive in a module-info.java file, Java Inconsistency Analysis explores actual and specified dependencies, stored in their respective database components. It identifies any occurrence of an inconsistent dependency previously defined and reports the identified architectural inconsistency, the module affected,and the specific directive involved. This component is implemented in Java (`Check_Consistency.jar`).
* Java Reflection Analysis: It leverages a custom static analysis, which we have implemented using the Soot framework [2], to identify usage of reflection in the input application. This component is implemented in Java (`java_reflection_analysis.jar`)
* ServiceLoader Analysis: It leverages a custom static analysis using the Soot framework to identify usage of java.util.ServiceLoader in the input application. This component is implemented in Java (`uses_provides_analysis.jar`)
* Module-Info Transformer: This component leverages ANTLR [3] and deletes or modifies the explicit dependencies defined in the module-info files to repair the identified inconsistencies within Java applications. This component is implemented in Java (`ModuleInfoTransformer.jar`).

The `runAll.sh` script, located in the _Darcy_ directory, runs all these components in the explained order. After running this script, it asks for a Java project path as an input, runs Darcy’s components, and reports its output. The output contains all the reports regarding each Darcy’s component. The identified inconsistencies are reported as "_FOUND INCONSISTENCIES_", and also saved in a text file `excessDirectives.txt` in the Darcy directory. The identified inconsistencies of type _opens_  are reported in the Java reflection analysis output and also saved in `excessOpenDirectives.txt` in Darcy directory. The inconsistencies of type _uses_ are reported as "_Excess Uses_", and also saved in `excessUsesDirectives.txt`. Finally, in the output of the repair section, the modified module-info files are printed after Darcy’s repair. The original module-info files within the target Java project is also modified and saved.
You can leverage the virtual machine image we provide here. There is a directory `Darcy` on the desktop which contains all the source files and the runAll script. The username and password for logging into the VM image are:
```
Username: negar
password : "1"
```
## 2. Input Data ##
This repository also contains the input data for executing Darcy; these input data contain  these data were used in evaluating Darcy as reported in the paper. This input data contains open-source Java-9 applications which are located in a folder named “dataset_projects” at the Darcy directory in this repo. You  can use any of the Java projects within this directory, however, for more convenience, you can use the following example input:
First run the script:
./runAll.sh
2- When it asks for “Project Path”, enter the following address:
/home/negar/Desktop/Darcy/Java9-Module-Inconsistencies/dataset_projects/sense-nine-start-point
The output for this example input is provided in “exampleOutPut.txt” in the root directory.

